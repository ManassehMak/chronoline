<!DOCTYPE html>
<html>
<head>
    <title>Advanced Chronoline</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            overflow: hidden;
            background: #000;
            font-family: 'Arial', sans-serif;
            touch-action: none;
        }

        .container {
            width: 100vw;
            height: 100vh;
            position: relative;
            perspective: 1000px;
        }

        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(255,255,255,0.1) 1px, transparent 1px),
                radial-gradient(circle at 80% 70%, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 30px 30px;
            animation: stars-move 200s linear infinite;
        }

        @keyframes stars-move {
            100% { background-position: 100% 100%; }
        }

        .timeline-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform-style: preserve-3d;
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .timeline-line {
            height: 20vh;
            background: linear-gradient(
                to right,
                transparent 0%,
                #FFF3E0 20%,
                #FFF3E0 80%,
                transparent 100%
            );
            box-shadow: 0 0 30px rgba(255, 243, 224, 0.4);
            position: relative;
            border-radius: 5px;
            transform: rotateX(15deg);
        }

        .graduation {
            position: absolute;
            transform-origin: center bottom;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.3s ease;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        .graduation-label {
            color: #000080;
            font-size: 12px;
            white-space: nowrap;
            padding: 2px 5px;
            background: rgba(255,255,255,0.9);
            border-radius: 3px;
            margin-bottom: 5px;
            font-weight: bold;
            transform: translateZ(10px);
        }

        .graduation-line {
            width: 2px;
            background: #000080;
            transition: height 0.3s ease;
        }

        .event-marker {
            position: absolute;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            transform-style: preserve-3d;
            z-index: 2;
        }

        .event-shape {
            width: 20px;
            height: 20px;
            position: absolute;
            transform: translate(-50%, -50%) rotate(45deg);
            background: #009688;
            box-shadow: 0 0 15px rgba(0,150,136,0.5);
            transition: all 0.3s ease;
        }

        .event-info {
            /* Стили остаются прежними */
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="stars"></div>
        <div class="timeline-container" id="timelineContainer">
            <div class="timeline-line" id="timelineLine"></div>
        </div>
    </div>

    <script>
        const eventsData = {
            events: [
                // 30 событий разных типов и важности
                {id:1, title:"Война за испанское наследство", start:"1701-07-09", end:"1714-09-07", type:"range", importance:"century"},
                {id:2, title:"Промышленная революция", start:"1760-01-01", end:"1840-01-01", type:"range", importance:"century"},
                {id:3, title:"Открытие ДНК", date:"1953-02-28", type:"single", importance:"decade"},
                // ... добавьте остальные 27 событий по аналогии
            ]
        };

        class Chronoline {
            constructor() {
                this.minYear = 1700;
                this.maxYear = 2050;
                this.scale = 1;
                this.offset = 0;
                this.tilt = 0;
                this.lastActivity = Date.now();
                this.events = eventsData.events;
                this.importanceLevels = {century:1, decade:2, year:3, month:4, day:5};
                
                this.init();
            }

            init() {
                this.createTimelineElements();
                this.setupEventHandlers();
                this.animationLoop();
            }

            createTimelineElements() {
                this.createGraduations();
                this.placeEvents();
            }

            createGraduations() {
                const levels = [
                    {type:'century', step:100, height:40},
                    {type:'halfCentury', step:50, height:30},
                    {type:'decade', step:10, height:25},
                    {type:'year', step:1, height:15},
                    {type:'quarter', step:0.25, height:10},
                    {type:'month', step:1/12, height:8},
                    {type:'day', step:1/365, height:5}
                ];

                levels.forEach(level => {
                    for(let y=this.minYear; y<=this.maxYear; y+=level.step){
                        this.createMark(y, level.height, this.getLabel(y, level.type), level.type);
                    }
                });
            }

            createMark(year, height, label, type) {
                // Реализация создания меток
            }

            placeEvents() {
                this.events.forEach(event => {
                    const pos = this.calculatePosition(event.start || event.date);
                    this.createEventMarker(event, pos);
                });
            }

            createEventMarker(event, position) {
                // Реализация создания маркеров событий
            }

            setupEventHandlers() {
                // Обработчики мыши и тач-событий
                window.addEventListener('wheel', this.handleWheel.bind(this));
                window.addEventListener('mousemove', this.handleMouseMove.bind(this));
                window.addEventListener('touchstart', this.handleTouchStart.bind(this));
                window.addEventListener('touchmove', this.handleTouchMove.bind(this));
            }

            handleWheel(e) {
                // Логика масштабирования
            }

            handleMouseMove(e) {
                // Логика наклона
            }

            handleTouchStart(e) {
                // Начало касания
            }

            handleTouchMove(e) {
                // Обработка перемещения пальцев
            }

            updateTransforms() {
                // Обновление всех преобразований
            }

            animationLoop() {
                // Основной цикл анимации
                requestAnimationFrame(() => this.animationLoop());
                this.updateVisibility();
                this.autoReset();
            }

            updateVisibility() {
                // Обновление видимости элементов
            }

            autoReset() {
                // Автоматический сброс через 5 сек
            }
        }

        // Инициализация при загрузке
        window.addEventListener('load', () => new Chronoline());
    </script>
</body>
</html>